{"version":3,"sources":["index.js"],"names":["Importabular","data","node","options","LooseArray","onChange","onSelectionChange","contentStyle","cellStyle","minHeight","maxHeight","Infinity","minWidth","maxWidth","borderSpacing","background","border","e","editing","preventDefault","rows","parsePasteEvent","selection","rx","ry","offset","x","y","forEach","row","val","setVal","changeSelectedCellsStyle","selectionStart","selectionEnd","length","onDataChanged","asArr","getSelectionAsArray","clipboardData","setData","arrToHTML","map","join","copy","setAllSelectedCellsTo","ctrlKey","key","revertEdit","stopEditing","moveCursor","shiftKey","startEditing","getCell","firstChild","value","mobile","tbody","style","userSelect","getCoords","selecting","endSelection","lastMouseUp","Date","now","lastMouseUpTarget","moved","td","width","height","input","removeEventListener","blurIfEnter","removeChild","renderTDContent","keyCode","status","getStatus","cell","Object","assign","TDStyle","div","tagName","innerText","getVal","restyle","parent","setupDom","replaceDataWithArray","incrementToFit","toArr","clear","refreshDisplayedValue","document","createElement","setAttribute","toString","innerHTML","appendChild","table","tableStyle","tr","addCell","addEventListener","mousedown","mouseenter","mouseup","mouseleave","touchstart","touchend","touchmove","keydown","paste","cut","destroyEditing","parentElement","Array","prototype","call","children","fitBounds","incrementWidth","incrementHeight","result","push","forSelectionCoord","shiftSelectionEnd","curr","nc","tdSize","getBoundingClientRect","cellSize","type","focus","callback","oldS","getSelectionCoords","reverse","cb","selected","onlySelected","editTarget","padding","borderStyle","borderWidth","borderColor","boxSizing","cleanStyle","arguments","font","lineHeight","color","target","getAttribute","parseInt","line","selectedCount","hash","cleanedVal","cleanVal","isEmpty","Math","max","obj","keys","arr","outerHTML","event","html","window","getData","iframe","body","contentWindow","open","write","close","trs","querySelectorAll","tds","text","ensureDimensions","split","s"],"mappings":"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","file":"index.js","sourceRoot":"../src","sourcesContent":["\n\n\nexport default class Importabular{\n  parent=null\n  width=1\n  height=1\n  data=new LooseArray()\n  options={\n    onChange:null,\n    onSelectionChange:null,\n    contentStyle:()=>null,\n    cellStyle:()=>null,\n    minHeight:1,\n    maxHeight:Infinity,\n    minWidth:1,\n    maxWidth:Infinity,\n  }\n  fitBounds({x,y}){\n    return x>=0 && x<this.options.maxWidth\n    && y>=0 && y<this.options.maxHeight\n  }\n  constructor({data=[],node, ...options}) {\n    this.parent=node\n    Object.assign(this.options, options)\n    this.setupDom()\n    this.replaceDataWithArray(data)\n    this.incrementToFit({x:this.options.minWidth-1, y:this.options.minHeight-1})\n  }\n  onDataChanged(){\n    if(this.options.onChange){\n      this.options.onChange(this.data.toArr())\n    }\n  }\n  setData(data){\n    this.data.clear()\n    data.forEach((row,y)=>\n      row.forEach((val,x)=>\n        this.setVal(x,y,val)\n      ))\n    for(let x=0;x<this.width;x++)\n      for(let y=0;y<this.height;y++)\n        this.refreshDisplayedValue({x,y})\n\n  }\n  renderTDContent(td, x,y){\n    const div=document.createElement('div')\n    td.setAttribute('x',x.toString())\n    td.setAttribute('y',y.toString())\n    const val=this.getVal( x,y)\n    if(val){\n      div.innerText=val;\n    }else{\n      // Force no collapse of cell\n      div.innerHTML='&nbsp;'\n    }\n    td.appendChild(div)\n    this.restyle({x,y})\n\n  }\n  tableStyle={\n    borderSpacing:0,\n    background:'white',\n    border:'1px solid #ddd'\n\n  }\n  setupDom(){\n    const table=document.createElement('table')\n    const tbody=document.createElement('tbody')\n    Object.assign(table.style,this.tableStyle)\n\n\n    table.appendChild(tbody)\n    this.parent.appendChild(table)\n    this.tbody=tbody\n    this.table=table\n\n    for(let y=0;y<this.height;y++){\n      const tr=document.createElement('tr')\n      tbody.appendChild(tr)\n      for(let x=0;x<this.width;x++){\n        this.addCell(tr,x,y)\n      }\n    }\n\n    tbody.addEventListener('mousedown', this.mousedown, true)\n    tbody.addEventListener('mouseenter', this.mouseenter, true)\n    tbody.addEventListener('mouseup', this.mouseup, true)\n    tbody.addEventListener('mouseleave', this.mouseleave)\n    tbody.addEventListener('touchstart', this.touchstart, true)\n    tbody.addEventListener('touchend', this.touchend, true)\n    tbody.addEventListener('touchmove', this.touchmove, true)\n    document.addEventListener('keydown', this.keydown, true)\n    document.addEventListener('paste', this.paste)\n    document.addEventListener('cut', this.cut)\n    document.addEventListener('copy', this.copy)\n  }\n\n  destroy(){\n    this.destroyEditing()\n\n    // Remove global listeners\n    const tbody=this.tbody\n    tbody.removeEventListener('mousedown', this.mousedown, true)\n    tbody.removeEventListener('mouseenter', this.mouseenter, true)\n    tbody.removeEventListener('mouseup', this.mouseup, true)\n    tbody.removeEventListener('mouseleave', this.mouseleave)\n    tbody.removeEventListener('touchstart', this.touchstart, true)\n    tbody.removeEventListener('touchend', this.touchend, true)\n    tbody.removeEventListener('touchmove', this.touchmove, true)\n    document.removeEventListener('keydown', this.keydown, true)\n    document.removeEventListener('copy', this.copy)\n    document.removeEventListener('cut', this.cut)\n    document.removeEventListener('paste', this.paste)\n\n    this.table.parentElement.removeChild(this.table)\n  }\n\n\n  addCell(tr, x,y){\n    const td=document.createElement('td')\n    tr.appendChild(td)\n    this.renderTDContent(td,x,y)\n  }\n\n  incrementHeight(){\n\n    this.height++\n    const y=this.height-1\n    const tr=document.createElement('tr')\n\n    this.tbody.appendChild(tr)\n    for(let x=0;x<this.width;x++){\n      this.addCell(tr, x,y)\n    }\n  }\n\n  incrementWidth(){\n\n    this.width++\n    const x=this.width-1\n    Array.prototype.forEach.call(this.tbody.children, (tr,y)=>{\n      this.addCell(tr, x,y)\n    })\n  }\n  incrementToFit({x,y}){\n    if(!this.fitBounds({x,y})) return\n    while(x>this.width-1) this.incrementWidth()\n    while(y>this.height-1) this.incrementHeight()\n  }\n  paste=e=>{\n    if(this.editing) return\n    e.preventDefault();\n    const rows=parsePasteEvent(e)\n    const {rx,ry}= this.selection\n    const offset={x:rx[0], y:ry[0]}\n\n    rows.forEach((row, y)=>{\n      row.forEach((val, x)=>{\n        this.setVal(offset.x+x, offset.y+y, val)\n      })\n    })\n\n    this.changeSelectedCellsStyle(()=>{\n      this.selectionStart=offset\n      this.selectionEnd ={\n        x:offset.x+rows[0].length-1,\n        y:offset.y+rows.length-1\n      }\n    })\n    this.onDataChanged()\n  }\n  getSelectionAsArray(){\n    const {rx,ry}=this.selection\n    if(rx[0]===rx[1]) return null\n    const width=rx[1]-rx[0]\n    const height=ry[1]-ry[0]\n    const result=[]\n    for(let y=0;y<height;y++){\n      result.push([])\n      for(let x=0;x<width;x++){\n        result[y].push(this.getVal(rx[0]+x, ry[0]+y))\n      }\n    }\n    return result\n  }\n  copy=e=>{\n    const asArr=this.getSelectionAsArray()\n    if(asArr){\n      e.preventDefault()\n      e.clipboardData.setData('text/html', arrToHTML(asArr));\n      e.clipboardData.setData('text/plain', asArr.map(row=>row.join('\\t')).join('\\n'));\n    }\n  }\n\n  cut=e=>{\n    this.copy(e)\n    this.setAllSelectedCellsTo('')\n  }\n\n  keydown=e=>{\n\n    if(e.ctrlKey) return\n\n    if(this.selectionStart){\n      if(e.key==='Escape' && this.editing){\n        e.preventDefault()\n        this.revertEdit()\n        this.stopEditing()\n      }\n      if(e.key==='Enter'){\n        e.preventDefault()\n        this.moveCursor({y:1})\n      }\n\n      if(e.key==='Tab'){\n        e.preventDefault()\n        this.moveCursor({x:e.shiftKey?-1:1})\n      }\n      if(!this.editing){\n\n        if(e.key==='Delete' || e.key==='Backspace'){\n          e.preventDefault()\n          this.setAllSelectedCellsTo('')\n        }\n        if(e.key==='ArrowDown'){\n          e.preventDefault()\n          this.moveCursor({y:1},e.shiftKey)\n        }\n\n        if(e.key==='ArrowUp'){\n          e.preventDefault()\n          this.moveCursor({y:-1},e.shiftKey)\n        }\n        if(e.key==='ArrowLeft'){\n          e.preventDefault()\n          this.moveCursor({x:-1},e.shiftKey)\n        }\n        if(e.key==='ArrowRight'){\n          e.preventDefault()\n          this.moveCursor({x:+1},e.shiftKey)\n        }\n      }\n\n\n      if(e.key.length === 1 && !this.editing){\n        this.changeSelectedCellsStyle(()=>{\n          const {x,y}=this.selectionStart\n          // We clear the value of the cell, and the keyup event will\n          // happen with the cursor inside the cell and type the character there\n          this.startEditing({x,y})\n          this.getCell(x,y).firstChild.value=''\n        })\n      }\n    }\n  }\n  setAllSelectedCellsTo(value){\n    this.forSelectionCoord(this.selection,({x,y})=>this.setVal(x,y,value))\n    this.forSelectionCoord(this.selection,this.refreshDisplayedValue)\n\n    this.onDataChanged()\n  }\n  moveCursor({x=0,y=0}, shiftSelectionEnd){\n    const curr=shiftSelectionEnd? this.selectionEnd : this.selectionStart\n    const nc = {x:curr.x+x, y:curr.y+y}\n    if(!this.fitBounds(nc)) return\n    this.stopEditing()\n    this.incrementToFit(nc)\n    this.changeSelectedCellsStyle(()=>{\n      if(shiftSelectionEnd){\n        this.selectionEnd =nc\n      }else{\n        this.selectionStart=this.selectionEnd =nc\n      }\n    })\n  }\n  selecting=false;\n  selectionStart=null\n  selectionEnd=null\n  selection={rx:[0,0],ry:[0,0]}\n  editing=null\n\n  mousedown=e=>{\n    if(this.mobile) return\n    this.changeSelectedCellsStyle(()=>{\n      this.tbody.style.userSelect='none'\n      this.selectionStart=this.getCoords(e);\n      this.selectionEnd=this.selectionStart\n      this.selecting=true;\n    })\n  }\n  mouseenter=e=>{\n    if(this.mobile) return\n    if(this.selecting){\n      this.changeSelectedCellsStyle(()=>{\n        this.selectionEnd=this.getCoords(e);\n      })\n    }\n  }\n\n  lastMouseUp=null\n  lastMouseUpTarget=null\n  endSelection(){\n    this.selecting=false;\n    this.tbody.style.userSelect=''\n  }\n  mouseup=e=>{\n    if(this.mobile) return\n    if(this.selecting){\n      this.changeSelectedCellsStyle(()=>{\n        this.selectionEnd=this.getCoords(e);\n        this.endSelection()\n\n        if(this.lastMouseUp &&\n          this.lastMouseUp>Date.now()-300 &&\n          this.lastMouseUpTarget.x===this.selectionEnd.x &&\n          this.lastMouseUpTarget.y===this.selectionEnd.y\n        ){\n          this.startEditing(this.selectionEnd)\n        }\n        this.lastMouseUp=Date.now()\n        this.lastMouseUpTarget=this.selectionEnd\n      })\n    }\n  }\n  mouseleave=e=>{\n    if(this.selecting){\n      this.endSelection()\n    }\n  }\n\n  touchstart=e=>{\n    if(this.editing) return\n    this.mobile=true\n    this.moved=false\n  }\n  touchend=e=>{\n    if(this.editing) return\n    if(!this.moved){\n\n      this.changeSelectedCellsStyle(()=>{\n        this.selectionEnd=this.selectionStart=this.getCoords(e);\n      })\n      this.startEditing(this.selectionEnd)\n    }\n  }\n  touchmove=e=>{\n    this.moved=true\n  }\n\n  startEditing({x,y}){\n\n    this.editing={x,y}\n    const td=this.getCell(x,y)\n    const tdSize=td.getBoundingClientRect()\n    const cellSize=td.firstChild.getBoundingClientRect()\n    Object.assign(td.style, {\n      width:tdSize.width,\n      height:tdSize.height,\n    })\n\n    td.removeChild(td.firstChild)\n    const input=document.createElement('input');\n    input.type='text'\n    input.value=this.getVal(x,y)\n\n    Object.assign(input.style, {\n      width:cellSize.width,\n      height:cellSize.height,\n    })\n    td.appendChild(input)\n    input.focus()\n    input.addEventListener('blur', this.stopEditing)\n    input.addEventListener('keydown', this.blurIfEnter)\n  }\n\n  destroyEditing(){\n    if(this.editing){\n      const {x,y}=this.editing\n      const input=this.getCell(x,y).firstChild\n      input.removeEventListener('blur', this.stopEditing)\n      input.removeEventListener('keydown', this.blurIfEnter)\n    }\n  }\n  revertEdit(){\n    if(!this.editing) return\n    const {x,y}=this.editing\n    const td=this.getCell(x,y)\n    const input = td.firstChild\n    input.value=this.getVal(x,y)\n  }\n  stopEditing=()=>{\n    if(!this.editing) return\n    const {x,y}=this.editing\n    const td=this.getCell(x,y)\n    td.style.width=''\n    td.style.height=''\n    const input = td.firstChild\n    input.removeEventListener('blur', this.stopEditing)\n    input.removeEventListener('keydown', this.blurIfEnter)\n    this.setVal(x,y,input.value)\n    td.removeChild(input)\n    this.editing=null\n    this.renderTDContent(td, x,y)\n    this.onDataChanged()\n  }\n  blurIfEnter=e=>{\n    const code=e.keyCode\n    if(code===13){\n      // enter\n      this.stopEditing()\n      e.preventDefault()\n    }\n  }\n  changeSelectedCellsStyle(callback){\n    const oldS=this.selection\n    callback()\n    this.selection=this.getSelectionCoords()\n    this.forSelectionCoord(oldS,this.restyle)\n    this.forSelectionCoord(this.selection,this.restyle)\n    if(this.options.onSelectionChange){\n      this.options.onSelectionChange(this.selection)\n    }\n  }\n  getSelectionCoords(){\n    if(!this.selectionStart) return {rx:[0,0], ry:[0,0]}\n    let rx=[this.selectionStart.x,this.selectionEnd.x]\n    if(rx[0]>rx[1]) rx.reverse()\n    let ry=[this.selectionStart.y,this.selectionEnd.y]\n    if(ry[0]>ry[1]) ry.reverse()\n    return {rx:[rx[0],rx[1]+1],ry:[ry[0],ry[1]+1]}\n  }\n  forSelectionCoord({rx,ry}, cb){\n    for(let x=rx[0];x<rx[1];x++)\n      for(let y=ry[0];y<ry[1];y++)\n        if(this.fitBounds({x,y}))\n          cb({x,y})\n  }\n  restyle=({x,y})=>{\n\n    const status =this.getStatus(x,y)\n    const cell=this.getCell(x,y)\n\n    Object.assign(cell.style, this.TDStyle(x,y,status))\n    Object.assign(cell.firstChild.style, this.contentStyle(x,y,status))\n  }\n\n  TDStyle(x,y,{selected,onlySelected, editTarget,editing}){\n\n    return {\n      padding:0,\n      background:selected && !editing && !onlySelected?'#d7f2f9':'',\n      borderStyle:'solid',\n      borderWidth:'1px',\n      borderColor:editTarget && !editing ? 'black' : (\n        [y ? '#ddd':'transparent','transparent','transparent',\n          x ? '#ddd':'transparent'].join(' ')\n      ),\n      boxSizing:'border-box',\n      ...cleanStyle(this.options.cellStyle(...arguments))\n    }\n  }\n  contentStyle(x,y,{selected,onlySelected, editTarget,editing}){\n    return {\n      border:'none',\n      padding:'10px',\n      minWidth:'100px',\n      minHeight:'40px',\n      font:'inherit',\n      lineHeight:'20px',\n      color:'inherit',\n      boxSizing:'border-box',\n      ...cleanStyle(this.options.contentStyle(...arguments))\n    }\n  }\n\n\n  refreshDisplayedValue=({x,y})=>{\n    const div=this.getCell(x,y).firstChild\n    if(div.tagName==='DIV'){\n      div.innerText=this.getVal(x,y)\n    }\n    this.restyle({x,y})\n  }\n\n\n  getCoords(e){\n    // Returns the clicked cell coords or null\n    let node=e.target;\n    while (!node.getAttribute('x') && node.parentElement && node.parentElement!==this.parent){\n      node=node.parentElement\n    }\n    return {\n      x:parseInt(node.getAttribute('x')) || 0,\n      y:parseInt(node.getAttribute('y')) || 0,\n    }\n  }\n\n\n  replaceDataWithArray(data) {\n\n    data.forEach((line, y)=>{\n      line.forEach((val, x)=>{\n        this.setVal( x,y, val)\n      })\n    })\n\n    this.onDataChanged()\n  }\n  setVal( x,y,val){\n\n    if(!this.fitBounds({x,y})) return\n\n    this.data.setVal( x,y, val)\n    this.incrementToFit({x:x+1,y:y+1})\n    this.refreshDisplayedValue({x,y})\n  }\n\n  getVal(x,y) {\n    return this.data.getVal(x,y)\n  }\n  getStatus(x,y){\n    const {rx,ry} = this.selection\n    const selected = x>=rx[0] && x<rx[1] && y>=ry[0] && y<ry[1]\n    const editTarget = x===rx[0] && y===ry[0] && rx[0]!==rx[1]\n    const editing= this.editing && x===this.editing.x &&  y===this.editing.y\n    const selectedCount = (rx[1]-rx[0])*(ry[1]-ry[0])\n    return {selected,editTarget,editing, onlySelected:selected && selectedCount<2}\n  }\n  getCell(x,y){\n    return this.tbody.children[y].children[x]\n  }\n\n}\n\nclass LooseArray{\n  // An 2D array of strings that only stores non \"\" values\n  data={}\n  setVal( x,y,val){\n    const hash=this.data\n    const cleanedVal=LooseArray.cleanVal(val)\n    if(cleanedVal){\n      if(!hash[x])hash[x]={}\n      hash[x][y] = cleanedVal\n    }else{\n      // delete item\n      if(hash[x] && hash[x][y]){\n        delete hash[x][y]\n        if(LooseArray.isEmpty(hash[x]))\n          delete hash[x]\n      }\n    }\n  }\n  clear(){\n    this.data={}\n  }\n  getVal(x,y) {\n    const hash=this.data\n    return hash && hash[x] && hash[x][y] || ''\n  }\n  static cleanVal(val){\n    if(val === 0) return '0'\n    if(!val) return ''\n    return val.toString()\n  }\n  static isEmpty(obj) {\n    return Object.keys(obj).length === 0\n  }\n  toArr(){\n    let width=1, height=1;\n    for(let x in this.data){\n      for(let y in this.data[x]){\n        height=Math.max(height, parseInt(y)+1)\n        width=Math.max(width, parseInt(x)+1)\n      }\n    }\n    const result=[];\n    for(let y = 0; y<height;y++){\n      result.push([])\n      for(let x = 0; x<width; x++){\n        result[y].push(this.getVal(x,y))\n      }\n    }\n    return result\n  }\n\n}\n\n\n\nfunction arrToHTML(arr) {\n  const table=document.createElement('table')\n  arr.forEach(row=>{\n    const tr=document.createElement('tr')\n    table.appendChild(tr)\n    row.forEach(cell=>{\n      const td=document.createElement('td')\n      tr.appendChild(td)\n      td.innerText=cell\n    })\n  })\n  return table.outerHTML\n}\nfunction parsePasteEvent(event) {\n  try{\n\n    const html = (event.clipboardData || window.clipboardData).getData('text/html')\n\n    const iframe = document.createElement('iframe');\n    document.body.appendChild(iframe);\n    iframe.contentWindow.document.open();\n    iframe.contentWindow.document.write(html);\n    iframe.contentWindow.document.close();\n\n    const trs=iframe.contentWindow.document.querySelectorAll('tr')\n    const data=[];\n    Array.prototype.forEach.call(trs, (tr, y)=>{\n      const tds=tr.querySelectorAll('td')\n      Array.prototype.forEach.call(tds, (td, x)=>{\n        const text=td.innerText;\n        if(!data[y]) data[y]=[]\n        data[y][x]=text\n      })\n    })\n\n    document.body.removeChild(iframe);\n    if(data.length) return ensureDimensions(data)\n\n  }catch (e) {\n  }\n\n\n  const fromText= (event.clipboardData || window.clipboardData).getData('text')\n    .split(/\\r\\n|\\n|\\r/).map(row => row.split('\\t'))\n  return ensureDimensions(fromText)\n}\n\nfunction ensureDimensions(rows) {\n  if(!rows || !rows.length || !rows[0].length) return []\n  const width=rows[0].length\n  const height=rows.length\n  const result = []\n  for(var y=0;y<height;y++){\n    result.push([])\n    for(var x=0;x<width;x++){\n      const val = rows[y][x] || ''\n      result[y].push(val)\n    }\n  }\n  return result\n}\n\nfunction cleanStyle(s) {\n  if(!s) return {}\n  Object.keys(s).forEach(key => !s[key] && s[key]!==0 && delete s[key]);\n  return s\n}"]}